<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.1 Creating a Kafka Instance :: Object Detection Workshop</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/rhods-od-workshop/rhods-od-workshop/3-01-create-kafka.html">
    <link rel="prev" href="2-03-calling-from-application.html">
    <link rel="next" href="3-02-respawn-notebook.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/rhods-od-workshop">Object Detection Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhods-od-workshop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">1. Notebooks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-01-start-jupyter.html">1. Starting a Jupyter environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-02-jupyter-env.html">2. The Jupyter environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-03-notebooks.html">3. Notebooks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-04-object-detection.html">4. Object Detection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-05-model-api.html">5. Serving a Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">2. Serving with S2I</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-01-deploy-s2i.html">1. Deploy with Source to Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-02-testing-deployment.html">2. Testing the Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-03-calling-from-application.html">3. Calling from an Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3. Working with Kafka</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="3-01-create-kafka.html">1. Create a Kafka Instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-02-respawn-notebook.html">2. Restart a Notebook Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-03-explore-kafka.html">3. Explore Kafka in a Notebook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-04-create-secret.html">4. Create a Secret to Connect</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-05-kakfa-consumer.html">5. Deploy a Kafka Consumer</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Object Detection Workshop</a></li>
    <li>3. Working with Kafka</li>
    <li><a href="3-01-create-kafka.html">1. Create a Kafka Instance</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/rhods-od-workshop/edit/master/documentation/modules/ROOT/pages/3-01-create-kafka.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">3.1 Creating a Kafka Instance</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have the model working on pictures, let&#8217;s get this working with streaming data.</p>
</div>
<div class="paragraph">
<p>A Kafka instance in OpenShift Streams for Apache Kafka includes a Kafka cluster, bootstrap server, and the configurations needed to connect to producer and consumer services.  We&#8217;ll be creating:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Instance - record your <strong>Bootstrap server</strong></p>
</li>
<li>
<p>Service Account - record your <strong>Client ID</strong> and <strong>Client Secret</strong></p>
</li>
<li>
<p>Topics - record the names</p>
<div class="ulist">
<ul>
<li>
<p>images</p>
</li>
<li>
<p>objects</p>
</li>
<li>
<p>notebook-test</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll be creating this Kafka instance and related resources in a similar same way as in the QuickStart <strong>Getting started with Red Hat OpenShift Streams for Apache Kafka</strong>.  You can find the QuickStart <a href="https://console.redhat.com/application-services/learning-resources?quickstart=getting-started">here</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/quickstart.png" alt="alt text" width="800">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_kafka_instance"><a class="anchor" href="#_create_a_kafka_instance"></a>Create a Kafka Instance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Let&#8217;s create our a Kafka instance.  In the OpenShift Streams for Apache Kafka web console, go to Streams for Apache Kafka &gt; Kafka Instances. <a href="https://console.redhat.com/application-services/streams/kafkas" class="bare">https://console.redhat.com/application-services/streams/kafkas</a></p>
</li>
<li>
<p>Click Create Kafka instance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a unique <strong>Name</strong> for the Kafka instance, such as <code>username-object-detection</code> and an appropriate <strong>Cloud region</strong>.</p>
</li>
<li>
<p>Click <strong>Create instance</strong> to start the creation process for your Kafka instance.<br>
The new Kafka instance is listed in the instances table. When the instance Status is Ready, you can start using the Kafka instance. You can use the options icon (three vertical dots) to view instance details, connect to the instance, or delete the instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although you can see Kafka instances created by other users in your organization, you can’t manage or connect to those instances. Only the user who creates an instance can edit or delete the instance, access the associated service account and topics, or connect to the instance.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances-create.png" alt="alt text" width="800">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_service_account"><a class="anchor" href="#_create_a_service_account"></a>Create a Service Account</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To connect your applications or services to a Kafka instance in the OpenShift Streams for Apache Kafka web console, you need to create a service account that’s associated with the instance. You also need to save the <strong>Bootstrap server</strong> endpoint for the instance, the generated <strong>Client ID</strong> and <strong>Client secret</strong>. You’ll use the service account and Kafka instance information later when you configure your application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Kafka Instances page of the web console, for the relevant Kafka instance that you want to connect to, select the options icon (three vertical dots) and click <strong>Connection</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances-actions.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Connection</strong> page, copy the <strong>Bootstrap server</strong> endpoint to a secure location. This is the bootstrap server endpoint that you’ll need for connecting to this Kafka instance.</p>
</li>
<li>
<p>Click <strong>Create service account</strong> to set up the account that you’ll use to access this Kafka instance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances-connection.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a unique service account name, such as <code>userx-kafka-sa</code>, add an optional description, and click <strong>Create</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/sa-create.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the generated <strong>Client ID</strong> and <strong>Client secret</strong> to a secure location. These are the credentials that you’ll use to connect to this Kafka instance.  We&#8217;ll be using the SASL/PLAIN method of authentication.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The generated credentials are displayed only one time, so ensure that you’ve successfully and securely saved the copied credentials before closing the credentials window.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>After you save the generated credentials to a secure location, select the confirmation check box in the credentials window and close the window.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To review your service account information, reset your credentials, or delete the service account, use the left navigation menu to go to the <a href="https://console.redhat.com/application-services/service-accounts">Service Accounts page</a>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/sa-create-success.png" alt="alt text" width="800">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_permissions"><a class="anchor" href="#_setting_permissions"></a>Setting Permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you create a service account to connect to a Kafka instance, you must also set the appropriate level of access for that new account in the Access Control List (ACL) of the Kafka instance. OpenShift Streams for Apache Kafka uses ACLs provided by Kafka that enable you to manage how other user accounts and service accounts are permitted to interact with the Kafka resources that you create.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Kafka Instances</strong> page of the web console, click the name of the Kafka instance that you created earlier.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances-create-complete.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>Access</strong> tab to view the current ACL for this instance.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-access-before.png" alt="alt text" width="640">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Manage access</strong>, use the <strong>Account</strong> drop-down menu to select the service account that you previously created, and click <strong>Next</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use your <strong>Client ID</strong> to filter and find your service account
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-manage-access-sa.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Under Assign Permissions, use the drop-down menus to set the permissions shown in the following table for this service account. Click Add to add each new resource permission.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These permissions enable applications associated with the service account to create and delete topics in the instance, to produce and consume messages in any topic in the instance, and to use any consumer group and any producer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ignore any validation errors on the <code>*</code> value
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="3">Resource Type</th>
<th class="tableblock halign-left valign-top" colspan="2">Permission</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactional ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-manage-access.png" alt="alt text" width="860">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-access-after.png" alt="alt text" width="800">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_topics"><a class="anchor" href="#_create_topics"></a>Create Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you create a Kafka instance, you can create Kafka topics to start producing and consuming messages in your services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Kafka Instances</strong> page of the web console, click the name of the Kafka instance that you created earlier.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instances-create-complete.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>Create the <code>images</code> topic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the Topics tab, click <strong>Create topic</strong>,</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-topics.png" alt="alt text" width="800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Follow the guided steps to define the topic details. Click <strong>Next</strong> to complete each step and click <strong>Finish</strong> to complete the setup.</p>
<div class="ulist">
<ul>
<li>
<p>Topic name: <code>images</code></p>
</li>
<li>
<p>Partitions: <code>1</code></p>
</li>
<li>
<p>Message retention</p>
<div class="ulist">
<ul>
<li>
<p>Retention time: A week <em>(default)</em></p>
</li>
<li>
<p>Retention size: Unlimited <em>(default)</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Replicas</p>
<div class="ulist">
<ul>
<li>
<p>Replicas: 3 <em>(default)</em></p>
</li>
<li>
<p>Minimum in-sync replicas: 2 <em>(default)</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/topic-name.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>Create the <code>objects</code> topic in the same way.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic name: <code>objects</code></p>
</li>
<li>
<p>Partitions: <code>1</code></p>
</li>
<li>
<p>Message retention</p>
<div class="ulist">
<ul>
<li>
<p>Retention time: A week <em>(default)</em></p>
</li>
<li>
<p>Retention size: Unlimited <em>(default)</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Replicas</p>
<div class="ulist">
<ul>
<li>
<p>Replicas: 3 <em>(default)</em></p>
</li>
<li>
<p>Minimum in-sync replicas: 2 <em>(default)</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create the <code>notebook-test</code> topic in the same way.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic name: <code>notebook-test</code></p>
</li>
<li>
<p>Partitions: <code>1</code></p>
</li>
<li>
<p>Message retention</p>
<div class="ulist">
<ul>
<li>
<p>Retention time: A week <em>(default)</em></p>
</li>
<li>
<p>Retention size: Unlimited <em>(default)</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Replicas</p>
<div class="ulist">
<ul>
<li>
<p>Replicas: 3 <em>(default)</em></p>
</li>
<li>
<p>Minimum in-sync replicas: 2 <em>(default)</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you&#8217;re done, you should have three topics listed, <code>images</code>, <code>objects</code>, and <code>notebook-test</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka/instance-topics-complete.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>Now, before we leave, you should have the following securely recorded:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bootstrap server</strong></p>
</li>
<li>
<p><strong>Client ID</strong></p>
</li>
<li>
<p><strong>Client Secret</strong></p>
</li>
<li>
<p><strong>Three Topic Names</strong></p>
<div class="ulist">
<ul>
<li>
<p>images</p>
</li>
<li>
<p>objects</p>
</li>
<li>
<p>notebook-test</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="3-02-respawn-notebook.html" class="xref page">head to the next section.</a></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="2-03-calling-from-application.html">3. Calling from an Application</a></span>
  <span class="next"><a href="3-02-respawn-notebook.html">2. Restart a Notebook Server</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
